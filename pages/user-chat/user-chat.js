(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user-chat/user-chat"],{2108:function(t,e,n){"use strict";(function(t){n("2b3c"),n("921b");r(n("66fd"));var e=r(n("4fa5"));function r(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},"4fa5":function(t,e,n){"use strict";n.r(e);var r=n("6758"),i=n("8e87");for(var o in i)"default"!==o&&function(t){n.d(e,t,function(){return i[t]})}(o);var a,s=n("f0c5"),u=Object(s["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],a);e["default"]=u.exports},6758:function(t,e,n){"use strict";var r,i=function(){var t=this,e=t.$createElement;t._self._c},o=[];n.d(e,"b",function(){return i}),n.d(e,"c",function(){return o}),n.d(e,"a",function(){return r})},"8e87":function(t,e,n){"use strict";n.r(e);var r=n("9135"),i=n.n(r);for(var o in r)"default"!==o&&function(t){n.d(e,t,function(){return r[t]})}(o);e["default"]=i.a},9135:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=i(n("a34a"));i(n("d86f"));function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){return u(t)||s(t,e)||a()}function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function s(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0)if(n.push(a.value),e&&n.length===e)break}catch(u){i=!0,o=u}finally{try{r||null==s["return"]||s["return"]()}finally{if(i)throw o}}return n}function u(t){if(Array.isArray(t))return t}function c(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(c){return void n(c)}s.done?e(u):Promise.resolve(u).then(r,i)}function l(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var o=t.apply(e,n);function a(t){c(o,r,i,a,s,"next",t)}function s(t){c(o,r,i,a,s,"throw",t)}a(void 0)})}}var h=function(){return n.e("components/user-chat/user-chat-bottom").then(n.bind(null,"8ff9"))},f=function(){return n.e("components/user-chat/user-chat-list").then(n.bind(null,"e34a"))},d={components:{userChatBottom:h,userChatList:f},data:function(){return{scrollTop:0,style:{contentH:0,itemH:0},list:[],loadtext:"点击加载更多"}},onLoad:function(e){var n=JSON.parse(e.userinfo);if(!n.userid)return t.showToast({title:"该用户不存在",icon:"none"}),t.navigateBack({delta:1});this.$chat.CurrentToUser={userid:n.userid,username:n.username,userpic:n.userpic},t.setNavigationBarTitle({title:n.username})},onUnload:function(){this.$chat.CurrentToUser={userid:0,username:"",userpic:""}},onReady:function(){this.__init()},methods:{__init:function(){var e=this;try{var n=t.getSystemInfoSync();this.style.contentH=n.windowHeight-t.upx2px(120)}catch(r){}this.getdata(),this.pageToBottom(!0),t.$on("UserChat",function(t){e.list.push(e.$chat.__format(t,{type:"chatdetail",isme:!1,olddata:e.list})),e.pageToBottom()})},pageToBottom:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=t.createSelectorQuery().in(this),o=i.selectAll(".chat-item");this.$nextTick(function(){o.fields({size:!0},function(t){if(t){if(n){e.style.itemH=0;for(var i=0;i<t.length;i++)e.style.itemH+=t[i].height}else e.style.itemH+=t.length>0?t[t.length-1].height:t[0].height;r&&(e.scrollTop=e.style.itemH>e.style.contentH?e.style.itemH:0)}}).exec()})},getdata:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{var n="chatdetail_"+this.User.userinfo.id+"_"+this.$chat.CurrentToUser.userid,r=t.getStorageSync(n);if(r=r?JSON.parse(r):[],!e&&r.length>10)return this.list=r.splice(0,10);this.list=r,this.loadtext=""}catch(i){t.showToast({title:"加载失败~",icon:"none"})}},submit:function(){var e=l(r.default.mark(function e(n){var i,a,s,u,c;return r.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",t.showToast({title:"请输入你要发送的消息~",icon:"none"}));case 2:return i=this.$chat.send({type:"text",data:n}),e.next=5,this.$http.post("/chat/send",i,{token:!0,checkToken:!0,checkAuth:!0});case 5:if(a=e.sent,s=o(a,2),u=s[0],c=s[1],this.$http.errorCheck(u,c)){e.next=11;break}return e.abrupt("return",t.showToast({title:"发送失败",icon:"none"}));case 11:this.list.push(this.$chat.__format(i,{type:"chatdetail",olddata:this.list,isme:!0})),this.pageToBottom();case 13:case"end":return e.stop()}},e,this)}));function n(t){return e.apply(this,arguments)}return n}(),loadmore:function(){"点击加载更多"===this.loadtext&&(this.loadtext="加载中...",this.getdata(!0),this.pageToBottom(!0,!1))}}};e.default=d}).call(this,n("543d")["default"])}},[["2108","common/runtime","common/vendor"]]]);